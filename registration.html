<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>TechCloud - Registration</title>
		<!-- Description, Keywords and Author -->
		<meta name="description" content="Create your TechCloud account">
		<meta name="keywords" content="TechCloud,Registration,Signup">
		<meta name="author" content="TechCloud">
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<!-- Styles -->
		<!-- Bootstrap CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<!-- Font awesome CSS -->
		<link href="css/font-awesome.min.css" rel="stylesheet">		
		<!-- Custom CSS -->
		<link href="css/style.css" rel="stylesheet">
		
		<!-- Supabase -->
		<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
		
		<!-- Favicon -->
		<link rel="shortcut icon" href="#">
	</head>
	
	<body>
	
		<div class="wrapper">
		
			<!-- header -->
			<header>
				<!-- navigation -->
				<nav class="navbar navbar-default" role="navigation">
					<div class="container">
						<!-- Brand and toggle get grouped for better mobile display -->
						<div class="navbar-header">
							<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>
							<a class="navbar-brand" href="#"><img class="img-responsive" src="img/logo.png" alt="Logo" /></a>
						</div>

						<!-- Collect the nav links, forms, and other content for toggling -->
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul class="nav navbar-nav navbar-right">
								<li><a href="registration.html">Signup</a></li>
								<li><a href="login.html">Login</a></li>
								<li><a href="index.html">Home</a></li>
							</ul>
						</div><!-- /.navbar-collapse -->
					</div><!-- /.container-fluid -->
				</nav>
			</header>
			
			<!-- banner -->
			<div class="banner">
				<div class="container">
					<!-- form content / register area -->
					<div class="register-area">
						<!-- heading -->
						<h3>Sign Up, For An Account</h3>
						<form role="form" id="register-form">
							<div class="form-group">
								<input type="text" class="form-control" id="registerFullName" placeholder="Full Name" required>
							</div>
							<div class="form-group">
								<input type="email" class="form-control" id="registerEmail" placeholder="Enter email" required>
							</div>
							<div class="form-group">
								<input type="password" class="form-control" id="registerPassword" placeholder="Password" required minlength="6">
								<small class="text-muted">Password must be at least 6 characters long</small>
							</div>
							<div class="form-group">
								<input type="password" class="form-control" id="registerConfirmPassword" placeholder="Confirm Password" required>
							</div>
							<div class="checkbox form-group">
								<label>
									<input type="checkbox" id="agreeTerms" required> I agree with all terms and conditions.
								</label>
							</div>
							<button type="submit" class="btn btn-default" id="registerBtn">
								<span class="btn-text">Sign Up</span>
								<span class="btn-loading" style="display: none;">
									<i class="fa fa-spinner fa-spin"></i> Creating account...
								</span>
							</button>&nbsp;
							<button type="reset" class="btn btn-default">Reset</button>
						</form>
						<div class="text-center" style="margin-top: 15px;">
							<p>Already have an account? <a href="login.html">Sign in here</a></p>
						</div>
					</div>
				</div>
			</div>
			<!-- banner end -->
			
			<!-- footer -->
			<footer class="ffoot">
				<div class="container">
					<p><a href="#">Home</a> | <a href="#work">works</a> | <a href="#team">Team</a> | <a href="#contact">Contact</a></p>
					<div class="social">
						<a href="#"><i class="fa fa-facebook"></i></a>
						<a href="#"><i class="fa fa-twitter"></i></a>
						<a href="#"><i class="fa fa-dribbble"></i></a>
						<a href="#"><i class="fa fa-linkedin"></i></a>
						<a href="#"><i class="fa fa-google-plus"></i></a>
					</div>
					
				</div>
			</footer>

		</div>
		
		
		<!-- Javascript files -->
		<!-- jQuery -->
		<script src="js/jquery.js"></script>
		<!-- Bootstrap JS -->
		<script src="js/bootstrap.min.js"></script>
		<!-- Respond JS for IE8 -->
		<script src="js/respond.min.js"></script>
		<!-- HTML5 Support for IE -->
		<script src="js/html5shiv.js"></script>
		<!-- Supabase Config -->
		<script src="js/supabase-config.js"></script>
		<!-- Session Manager -->
		<script src="js/session-manager.js"></script>
		<!-- Auth Module -->
		<script src="js/auth.js"></script>
		<!-- Custom JS -->
		<script src="js/custom.js"></script>
		
		<!-- Registration Page Script -->
		<script>
			document.addEventListener('DOMContentLoaded', function() {
				const registerForm = document.getElementById('register-form');
				const registerBtn = document.getElementById('registerBtn');
				const btnText = registerBtn.querySelector('.btn-text');
				const btnLoading = registerBtn.querySelector('.btn-loading');

				// Handle registration form submission
				registerForm.addEventListener('submit', async function(e) {
					e.preventDefault();
					
					const fullName = document.getElementById('registerFullName').value;
					const email = document.getElementById('registerEmail').value;
					const password = document.getElementById('registerPassword').value;
					const confirmPassword = document.getElementById('registerConfirmPassword').value;
					const agreeTerms = document.getElementById('agreeTerms').checked;

					// Validation
					if (!fullName || !email || !password || !confirmPassword) {
						authManager.showMessage('Please fill in all fields', 'error');
						return;
					}

					if (password !== confirmPassword) {
						authManager.showMessage('Passwords do not match', 'error');
						return;
					}

					if (password.length < 6) {
						authManager.showMessage('Password must be at least 6 characters long', 'error');
						return;
					}

					if (!agreeTerms) {
						authManager.showMessage('Please agree to the terms and conditions', 'error');
						return;
					}

					// Show loading state
					btnText.style.display = 'none';
					btnLoading.style.display = 'inline';
					registerBtn.disabled = true;

					// Attempt registration
					const result = await authManager.signUp(email, password, fullName);

					// Reset button state
					btnText.style.display = 'inline';
					btnLoading.style.display = 'none';
					registerBtn.disabled = false;

					if (result.success) {
						// Clear form
						registerForm.reset();
						
						if (result.needsConfirmation) {
							authManager.showMessage('Registration successful! Please check your email to confirm your account.', 'success');
						} else {
							authManager.showMessage('Registration successful! You are now logged in.', 'success');
						}
					}
				});

				// Check if already logged in (with user feedback)
				// Allow bypass with ?force=true parameter for testing
				const urlParams = new URLSearchParams(window.location.search);
				const forceAccess = urlParams.get('force') === 'true';
				
				if (authManager && !forceAccess) {
					authManager.isAuthenticated().then(isAuth => {
						if (isAuth) {
							console.log('User already authenticated, redirecting...');
							// Show a message before redirecting
							authManager.showMessage('You are already logged in. Redirecting...', 'info');
							setTimeout(() => {
								window.location.href = 'index.html';
							}, 2000); // 2 second delay
						}
					}).catch(error => {
						console.error('Auth check error:', error);
						// If there's an auth error, clear any stale session
						authManager.signOut();
					});
				}
			});
		</script>
	</body>	
</html>